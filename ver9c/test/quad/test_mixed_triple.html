<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RDF Grapher ver9c - –¢–µ—Å—Ç Mixed Triple: 8 —Ñ–∞–∑ (—Å–º–µ—à–∞–Ω–Ω—ã–µ Simple –∏ Shorthand –æ–ø–µ—Ä–∞—Ü–∏–∏)</title>
    <!-- –°—Å—ã–ª–∫–∞ –Ω–∞ issue: https://github.com/bpmbpm/rdf-grapher/issues/256 -->
    <style>
        body { font-family: Consolas, Monaco, monospace; padding: 20px; background-color: #f5f5f5; }
        h1 { color: #333; border-bottom: 2px solid #FF5722; padding-bottom: 10px; }
        h2 { color: #FF5722; margin-top: 30px; }
        h3 { color: #FF7043; margin-top: 20px; font-size: 16px; }
        .step { padding: 10px 15px; margin: 5px 0; border-radius: 4px; font-size: 14px; }
        .step-passed { background-color: #d4edda; border-left: 4px solid #28a745; color: #155724; }
        .step-failed { background-color: #f8d7da; border-left: 4px solid #dc3545; color: #721c24; }
        .step-running { background-color: #fff3cd; border-left: 4px solid #ffc107; color: #856404; }
        .step-info { background-color: #d1ecf1; border-left: 4px solid #17a2b8; color: #0c5460; }
        .phase-header { background-color: #fbe9e7; border-left: 4px solid #FF5722; color: #bf360c; font-weight: bold; margin-top: 20px; }
        .phase-simple { border-left-color: #1976D2; background-color: #e3f2fd; }
        .phase-shorthand { border-left-color: #8E24AA; background-color: #f3e5f5; }
        .summary { margin-top: 20px; padding: 15px; border-radius: 4px; font-size: 16px; font-weight: bold; }
        .summary-passed { background-color: #d4edda; color: #155724; }
        .summary-failed { background-color: #f8d7da; color: #721c24; }
        .sparql-block { background-color: #263238; color: #EEFFFF; padding: 15px; border-radius: 4px; margin: 10px 0; font-size: 13px; white-space: pre-wrap; overflow-x: auto; }
        .data-block { background-color: #FAFAFA; border: 1px solid #E0E0E0; padding: 15px; border-radius: 4px; margin: 10px 0; font-size: 13px; white-space: pre-wrap; overflow-x: auto; max-height: 400px; overflow-y: auto; }
        #test-log { margin-top: 10px; }
        .legend { background-color: #fff; border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 4px; }
        .legend-item { display: inline-block; margin-right: 20px; }
        .legend-simple { color: #1976D2; font-weight: bold; }
        .legend-shorthand { color: #8E24AA; font-weight: bold; }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç Mixed Triple: 8 —Ñ–∞–∑</h1>
    <p>
        –°—Ü–µ–Ω–∞—Ä–∏–π —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —Å–º–µ—à–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Simple Triple –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏ Shorthand Triple –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è (–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç).<br><br>
        <strong>–ë–ª–æ–∫ A (Simple INSERT ‚Üí Shorthand DELETE):</strong><br>
        <span class="legend-simple">–§–∞–∑–∞ 1:</span> –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ (Simple Triple)<br>
        <span class="legend-simple">–§–∞–∑–∞ 2:</span> –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (Simple Triple)<br>
        <span class="legend-shorthand">–§–∞–∑–∞ 3:</span> –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ (Shorthand Triple)<br>
        <span class="legend-shorthand">–§–∞–∑–∞ 4:</span> –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (Shorthand Triple)<br><br>
        <strong>–ë–ª–æ–∫ B (Shorthand INSERT ‚Üí Simple DELETE):</strong><br>
        <span class="legend-shorthand">–§–∞–∑–∞ 5:</span> –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ (Shorthand Triple)<br>
        <span class="legend-shorthand">–§–∞–∑–∞ 6:</span> –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (Shorthand Triple)<br>
        <span class="legend-simple">–§–∞–∑–∞ 7:</span> –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ (Simple Triple)<br>
        <span class="legend-simple">–§–∞–∑–∞ 8:</span> –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (Simple Triple)
    </p>
    <div class="legend">
        <span class="legend-item"><span class="legend-simple">‚ñ† Simple Triple</span></span>
        <span class="legend-item"><span class="legend-shorthand">‚ñ† Shorthand Triple</span></span>
    </div>
    <div id="test-log"></div>
    <div id="test-summary"></div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ N3.js –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è RDF –¥–∞–Ω–Ω—ã—Ö -->
    <script src="https://unpkg.com/n3@1.17.2/browser/n3.min.js"></script>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Comunica –¥–ª—è SPARQL –∑–∞–ø—Ä–æ—Å–æ–≤ -->
    <script src="https://rdf.js.org/comunica-browser/versions/v4/engines/query-sparql-rdfjs/comunica-browser.js"></script>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ RDF Grapher (–≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —É—Ç–∏–ª–∏—Ç—ã) -->
    <script src="../../9_vadlib/vadlib.js"></script>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ SPARQL-–¥–≤–∏–∂–∫–∞ (funSPARQLvalues –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏) -->
    <script src="../../9_vadlib/vadlib_sparql.js"></script>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Ç—Ä–∏–ø–ª—Å—Ç–æ—Ä–∞ (parseTriGHierarchy, validateVAD) -->
    <script src="../../2_triplestore/2_triplestore_logic.js"></script>

    <script>
        // ============================================================================
        // –¢–µ—Å—Ç Mixed Triple: 8 —Ñ–∞–∑ —Å–º–µ—à–∞–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
        // –°—Å—ã–ª–∫–∞ –Ω–∞ issue: https://github.com/bpmbpm/rdf-grapher/issues/256
        // ============================================================================

        const testLog = document.getElementById('test-log');
        const testSummary = document.getElementById('test-summary');
        let stepResults = [];

        /**
         * –õ–æ–≥–∏—Ä—É–µ—Ç —à–∞–≥ —Å—Ü–µ–Ω–∞—Ä–∏—è —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Å—Ç–∞—Ç—É—Å–∞
         */
        function logStep(name, status, message, mode = null) {
            const div = document.createElement('div');
            let className = `step step-${status === 'phase' ? 'phase-header' : status}`;
            if (status === 'phase' && mode) {
                className += ` phase-${mode}`;
            }
            div.className = className;
            const icons = { passed: '‚úÖ', failed: '‚ùå', running: '‚è≥', info: '‚ÑπÔ∏è', phase: 'üìã' };
            div.textContent = `${icons[status] || ''} ${name}: ${message}`;
            testLog.appendChild(div);
            if (status === 'passed' || status === 'failed') {
                stepResults.push({ name, passed: status === 'passed', message });
            }
        }

        /**
         * –í—ã–≤–æ–¥–∏—Ç –±–ª–æ–∫ —Å SPARQL-–∑–∞–ø—Ä–æ—Å–æ–º –∏–ª–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤ –ª–æ–≥
         */
        function logBlock(title, content, type = 'data') {
            const h = document.createElement('h3');
            h.textContent = title;
            testLog.appendChild(h);

            const div = document.createElement('div');
            div.className = type === 'sparql' ? 'sparql-block' : 'data-block';
            div.textContent = content;
            testLog.appendChild(div);
        }

        /**
         * –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Ç–æ–≥–æ–≤—É—é —Å–≤–æ–¥–∫—É –ø–æ –≤—Å–µ–º —à–∞–≥–∞–º
         */
        function showSummary() {
            const passed = stepResults.filter(s => s.passed).length;
            const total = stepResults.length;
            const allPassed = passed === total;
            testSummary.className = `summary ${allPassed ? 'summary-passed' : 'summary-failed'}`;
            testSummary.textContent = `–†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞ Mixed Triple: ${passed}/${total} —à–∞–≥–æ–≤ –ø—Ä–æ–π–¥–µ–Ω–æ ${allPassed ? '‚úÖ' : '‚ùå'}`;
        }

        /**
         * –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∞ (TriG) –∏–∑ –º–∞—Å—Å–∏–≤–∞ –∫–≤–∞–¥–æ–≤
         */
        function getGraphContent(graphUri, quads, prefixes) {
            const graphQuads = quads.filter(q => q.graph && q.graph.value === graphUri);
            if (graphQuads.length === 0) return '(–≥—Ä–∞—Ñ –ø—É—Å—Ç)';

            const graphLabel = getPrefixedName(graphUri, prefixes);
            let output = `${graphLabel} {\n`;

            graphQuads.forEach(q => {
                const s = getPrefixedName(q.subject.value, prefixes);
                const p = getPrefixedName(q.predicate.value, prefixes);
                const o = q.object.termType === 'Literal'
                    ? `"${q.object.value}"`
                    : getPrefixedName(q.object.value, prefixes);
                output += `    ${s} ${p} ${o} .\n`;
            });

            output += '}';
            return output;
        }

        /**
         * –ü—Ä–∏–º–µ–Ω—è–µ—Ç SPARQL –∑–∞–ø—Ä–æ—Å –∫ currentStore —á–µ—Ä–µ–∑ Comunica
         */
        async function applySparql(sparqlQuery) {
            try {
                if (!comunicaEngine) {
                    if (typeof Comunica !== 'undefined' && Comunica.QueryEngine) {
                        comunicaEngine = new Comunica.QueryEngine();
                    } else {
                        throw new Error('Comunica –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                    }
                }

                await comunicaEngine.queryVoid(sparqlQuery, {
                    sources: [currentStore]
                });

                currentQuads = currentStore.getQuads(null, null, null, null);
                return true;
            } catch (error) {
                console.error('applySparql error:', error);
                throw error;
            }
        }

        /**
         * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏ –ø–∞—Ä—Å–∏—Ç TriG –¥–∞–Ω–Ω—ã–µ
         */
        async function loadTriGData() {
            const response = await fetch('../../dia/Trig_VADv5.ttl');
            if (!response.ok) throw new Error(`HTTP ${response.status}`);
            const data = await response.text();

            const quads = [];
            let prefixes = {};

            await new Promise((resolve, reject) => {
                const parser = new N3.Parser({ format: 'trig' });
                parser.parse(data, (error, quad, parsedPrefixes) => {
                    if (error) { reject(error); return; }
                    if (quad) { quads.push(quad); }
                    else {
                        if (parsedPrefixes) prefixes = parsedPrefixes;
                        resolve();
                    }
                });
            });

            return { quads, prefixes };
        }

        /**
         * –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–∞
         */
        async function runTest() {
            // ================================================================
            // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            // ================================================================
            logStep('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞', 'running', '–ó–∞–≥—Ä—É–∑–∫–∞ Trig_VADv5.ttl...');
            try {
                const { quads, prefixes } = await loadTriGData();
                currentQuads = quads;
                currentPrefixes = prefixes;
                currentStore = new N3.Store();
                quads.forEach(q => currentStore.addQuad(q));

                logStep('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞', 'passed', `–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${quads.length} –∫–≤–∞–¥–æ–≤, ${Object.keys(prefixes).length} –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤`);
            } catch (error) {
                logStep('–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞', 'failed', `–û—à–∏–±–∫–∞: ${error.message}`);
                showSummary();
                return;
            }

            const prefixLines = Object.entries(currentPrefixes)
                .map(([prefix, uri]) => `PREFIX ${prefix}: <${uri}>`)
                .join('\n');

            // ================================================================
            // –ë–õ–û–ö A: Simple INSERT ‚Üí Shorthand DELETE
            // ================================================================

            // –§–ê–ó–ê 1: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ (Simple Triple)
            logStep('–§–ê–ó–ê 1', 'phase', '–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ vad:process_mix_a (Simple Triple)', 'simple');

            const phase1Query = `${prefixLines}

INSERT DATA {
    GRAPH vad:ptree {
        vad:process_mix_a rdf:type vad:TypeProcess .
        vad:process_mix_a rdfs:label "–ü—Ä–æ—Ü–µ—Å—Å Mix A" .
        vad:process_mix_a dcterms:description "–¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è —Å–º–µ—à–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ (–±–ª–æ–∫ A)" .
        vad:process_mix_a vad:hasParentObj vad:p1 .
    }
}`;

            logBlock('–§–∞–∑–∞ 1 - SPARQL INSERT (Simple Triple)', phase1Query, 'sparql');
            try {
                await applySparql(phase1Query);
                const found = currentStore.getQuads(
                    N3.DataFactory.namedNode('http://example.org/vad#process_mix_a'),
                    N3.DataFactory.namedNode('http://www.w3.org/2000/01/rdf-schema#label'),
                    null,
                    N3.DataFactory.namedNode('http://example.org/vad#ptree')
                );
                if (found.length > 0) {
                    logStep('–§–∞–∑–∞ 1', 'passed', `–ö–æ–Ω—Ü–µ–ø—Ç vad:process_mix_a —Å–æ–∑–¥–∞–Ω (Simple). Label: "${found[0].object.value}"`);
                } else {
                    throw new Error('–ö–æ–Ω—Ü–µ–ø—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ INSERT');
                }
            } catch (error) {
                logStep('–§–∞–∑–∞ 1', 'failed', `–û—à–∏–±–∫–∞: ${error.message}`);
                showSummary();
                return;
            }

            const ptreeAfterPhase1 = getGraphContent('http://example.org/vad#ptree', currentQuads, currentPrefixes);
            logBlock('–§–∞–∑–∞ 1 - –°–æ–¥–µ—Ä–∂–∏–º–æ–µ vad:ptree –ø–æ—Å–ª–µ INSERT', ptreeAfterPhase1, 'data');

            // –§–ê–ó–ê 2: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (Simple Triple)
            logStep('–§–ê–ó–ê 2', 'phase', '–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è vad:executor_mix_a (Simple Triple)', 'simple');

            const phase2Query = `${prefixLines}

INSERT DATA {
    GRAPH vad:rtree {
        vad:executor_mix_a rdf:type vad:TypeExecutor .
        vad:executor_mix_a rdfs:label "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å Mix A" .
        vad:executor_mix_a vad:hasParentObj vad:Org-structure .
    }
}`;

            logBlock('–§–∞–∑–∞ 2 - SPARQL INSERT (Simple Triple)', phase2Query, 'sparql');
            try {
                await applySparql(phase2Query);
                const found = currentStore.getQuads(
                    N3.DataFactory.namedNode('http://example.org/vad#executor_mix_a'),
                    N3.DataFactory.namedNode('http://www.w3.org/2000/01/rdf-schema#label'),
                    null,
                    N3.DataFactory.namedNode('http://example.org/vad#rtree')
                );
                if (found.length > 0) {
                    logStep('–§–∞–∑–∞ 2', 'passed', `–ö–æ–Ω—Ü–µ–ø—Ç vad:executor_mix_a —Å–æ–∑–¥–∞–Ω (Simple). Label: "${found[0].object.value}"`);
                } else {
                    throw new Error('–ö–æ–Ω—Ü–µ–ø—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ INSERT');
                }
            } catch (error) {
                logStep('–§–∞–∑–∞ 2', 'failed', `–û—à–∏–±–∫–∞: ${error.message}`);
                showSummary();
                return;
            }

            const rtreeAfterPhase2 = getGraphContent('http://example.org/vad#rtree', currentQuads, currentPrefixes);
            logBlock('–§–∞–∑–∞ 2 - –°–æ–¥–µ—Ä–∂–∏–º–æ–µ vad:rtree –ø–æ—Å–ª–µ INSERT', rtreeAfterPhase2, 'data');

            // –§–ê–ó–ê 3: –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ (Shorthand Triple)
            logStep('–§–ê–ó–ê 3', 'phase', '–£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ vad:process_mix_a (Shorthand Triple)', 'shorthand');

            const phase3Query = `${prefixLines}

DELETE WHERE {
    GRAPH vad:ptree {
        vad:process_mix_a ?p ?o .
    }
}`;

            logBlock('–§–∞–∑–∞ 3 - SPARQL DELETE WHERE (Shorthand Triple)', phase3Query, 'sparql');
            try {
                await applySparql(phase3Query);
                const remaining = currentStore.getQuads(
                    N3.DataFactory.namedNode('http://example.org/vad#process_mix_a'),
                    null, null,
                    N3.DataFactory.namedNode('http://example.org/vad#ptree')
                );
                if (remaining.length === 0) {
                    logStep('–§–∞–∑–∞ 3', 'passed', '–ö–æ–Ω—Ü–µ–ø—Ç vad:process_mix_a —É–¥–∞–ª—ë–Ω (Shorthand)');
                } else {
                    throw new Error(`–ö–æ–Ω—Ü–µ–ø—Ç –Ω–µ —É–¥–∞–ª—ë–Ω: ${remaining.length} –∫–≤–∞–¥–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å`);
                }
            } catch (error) {
                logStep('–§–∞–∑–∞ 3', 'failed', `–û—à–∏–±–∫–∞: ${error.message}`);
                showSummary();
                return;
            }

            const ptreeAfterPhase3 = getGraphContent('http://example.org/vad#ptree', currentQuads, currentPrefixes);
            logBlock('–§–∞–∑–∞ 3 - –°–æ–¥–µ—Ä–∂–∏–º–æ–µ vad:ptree –ø–æ—Å–ª–µ DELETE', ptreeAfterPhase3, 'data');

            // –§–ê–ó–ê 4: –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (Shorthand Triple)
            logStep('–§–ê–ó–ê 4', 'phase', '–£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è vad:executor_mix_a (Shorthand Triple)', 'shorthand');

            const phase4Query = `${prefixLines}

DELETE WHERE {
    GRAPH vad:rtree {
        vad:executor_mix_a ?p ?o .
    }
}`;

            logBlock('–§–∞–∑–∞ 4 - SPARQL DELETE WHERE (Shorthand Triple)', phase4Query, 'sparql');
            try {
                await applySparql(phase4Query);
                const remaining = currentStore.getQuads(
                    N3.DataFactory.namedNode('http://example.org/vad#executor_mix_a'),
                    null, null,
                    N3.DataFactory.namedNode('http://example.org/vad#rtree')
                );
                if (remaining.length === 0) {
                    logStep('–§–∞–∑–∞ 4', 'passed', '–ö–æ–Ω—Ü–µ–ø—Ç vad:executor_mix_a —É–¥–∞–ª—ë–Ω (Shorthand)');
                } else {
                    throw new Error(`–ö–æ–Ω—Ü–µ–ø—Ç –Ω–µ —É–¥–∞–ª—ë–Ω: ${remaining.length} –∫–≤–∞–¥–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å`);
                }
            } catch (error) {
                logStep('–§–∞–∑–∞ 4', 'failed', `–û—à–∏–±–∫–∞: ${error.message}`);
                showSummary();
                return;
            }

            const rtreeAfterPhase4 = getGraphContent('http://example.org/vad#rtree', currentQuads, currentPrefixes);
            logBlock('–§–∞–∑–∞ 4 - –°–æ–¥–µ—Ä–∂–∏–º–æ–µ vad:rtree –ø–æ—Å–ª–µ DELETE', rtreeAfterPhase4, 'data');

            // ================================================================
            // –ë–õ–û–ö B: Shorthand INSERT ‚Üí Simple DELETE
            // ================================================================

            // –§–ê–ó–ê 5: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ (Shorthand Triple)
            logStep('–§–ê–ó–ê 5', 'phase', '–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ vad:process_mix_b (Shorthand Triple)', 'shorthand');

            const phase5Query = `${prefixLines}

INSERT DATA {
    GRAPH vad:ptree {
        vad:process_mix_b rdf:type vad:TypeProcess ;
            rdfs:label "–ü—Ä–æ—Ü–µ—Å—Å Mix B" ;
            dcterms:description "–¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è —Å–º–µ—à–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ (–±–ª–æ–∫ B)" ;
            vad:hasParentObj vad:p1 .
    }
}`;

            logBlock('–§–∞–∑–∞ 5 - SPARQL INSERT (Shorthand Triple)', phase5Query, 'sparql');
            try {
                await applySparql(phase5Query);
                const found = currentStore.getQuads(
                    N3.DataFactory.namedNode('http://example.org/vad#process_mix_b'),
                    N3.DataFactory.namedNode('http://www.w3.org/2000/01/rdf-schema#label'),
                    null,
                    N3.DataFactory.namedNode('http://example.org/vad#ptree')
                );
                if (found.length > 0) {
                    logStep('–§–∞–∑–∞ 5', 'passed', `–ö–æ–Ω—Ü–µ–ø—Ç vad:process_mix_b —Å–æ–∑–¥–∞–Ω (Shorthand). Label: "${found[0].object.value}"`);
                } else {
                    throw new Error('–ö–æ–Ω—Ü–µ–ø—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ INSERT');
                }
            } catch (error) {
                logStep('–§–∞–∑–∞ 5', 'failed', `–û—à–∏–±–∫–∞: ${error.message}`);
                showSummary();
                return;
            }

            const ptreeAfterPhase5 = getGraphContent('http://example.org/vad#ptree', currentQuads, currentPrefixes);
            logBlock('–§–∞–∑–∞ 5 - –°–æ–¥–µ—Ä–∂–∏–º–æ–µ vad:ptree –ø–æ—Å–ª–µ INSERT', ptreeAfterPhase5, 'data');

            // –§–ê–ó–ê 6: –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (Shorthand Triple)
            logStep('–§–ê–ó–ê 6', 'phase', '–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è vad:executor_mix_b (Shorthand Triple)', 'shorthand');

            const phase6Query = `${prefixLines}

INSERT DATA {
    GRAPH vad:rtree {
        vad:executor_mix_b rdf:type vad:TypeExecutor ;
            rdfs:label "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å Mix B" ;
            vad:hasParentObj vad:Org-structure .
    }
}`;

            logBlock('–§–∞–∑–∞ 6 - SPARQL INSERT (Shorthand Triple)', phase6Query, 'sparql');
            try {
                await applySparql(phase6Query);
                const found = currentStore.getQuads(
                    N3.DataFactory.namedNode('http://example.org/vad#executor_mix_b'),
                    N3.DataFactory.namedNode('http://www.w3.org/2000/01/rdf-schema#label'),
                    null,
                    N3.DataFactory.namedNode('http://example.org/vad#rtree')
                );
                if (found.length > 0) {
                    logStep('–§–∞–∑–∞ 6', 'passed', `–ö–æ–Ω—Ü–µ–ø—Ç vad:executor_mix_b —Å–æ–∑–¥–∞–Ω (Shorthand). Label: "${found[0].object.value}"`);
                } else {
                    throw new Error('–ö–æ–Ω—Ü–µ–ø—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ—Å–ª–µ INSERT');
                }
            } catch (error) {
                logStep('–§–∞–∑–∞ 6', 'failed', `–û—à–∏–±–∫–∞: ${error.message}`);
                showSummary();
                return;
            }

            const rtreeAfterPhase6 = getGraphContent('http://example.org/vad#rtree', currentQuads, currentPrefixes);
            logBlock('–§–∞–∑–∞ 6 - –°–æ–¥–µ—Ä–∂–∏–º–æ–µ vad:rtree –ø–æ—Å–ª–µ INSERT', rtreeAfterPhase6, 'data');

            // –§–ê–ó–ê 7: –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ (Simple Triple)
            logStep('–§–ê–ó–ê 7', 'phase', '–£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞ vad:process_mix_b (Simple Triple)', 'simple');

            const phase7Query = `${prefixLines}

DELETE WHERE {
    GRAPH vad:ptree {
        vad:process_mix_b ?p ?o .
    }
}`;

            logBlock('–§–∞–∑–∞ 7 - SPARQL DELETE WHERE (Simple Triple)', phase7Query, 'sparql');
            try {
                await applySparql(phase7Query);
                const remaining = currentStore.getQuads(
                    N3.DataFactory.namedNode('http://example.org/vad#process_mix_b'),
                    null, null,
                    N3.DataFactory.namedNode('http://example.org/vad#ptree')
                );
                if (remaining.length === 0) {
                    logStep('–§–∞–∑–∞ 7', 'passed', '–ö–æ–Ω—Ü–µ–ø—Ç vad:process_mix_b —É–¥–∞–ª—ë–Ω (Simple)');
                } else {
                    throw new Error(`–ö–æ–Ω—Ü–µ–ø—Ç –Ω–µ —É–¥–∞–ª—ë–Ω: ${remaining.length} –∫–≤–∞–¥–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å`);
                }
            } catch (error) {
                logStep('–§–∞–∑–∞ 7', 'failed', `–û—à–∏–±–∫–∞: ${error.message}`);
                showSummary();
                return;
            }

            const ptreeAfterPhase7 = getGraphContent('http://example.org/vad#ptree', currentQuads, currentPrefixes);
            logBlock('–§–∞–∑–∞ 7 - –°–æ–¥–µ—Ä–∂–∏–º–æ–µ vad:ptree –ø–æ—Å–ª–µ DELETE', ptreeAfterPhase7, 'data');

            // –§–ê–ó–ê 8: –£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (Simple Triple)
            logStep('–§–ê–ó–ê 8', 'phase', '–£–¥–∞–ª–µ–Ω–∏–µ –∫–æ–Ω—Ü–µ–ø—Ç–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è vad:executor_mix_b (Simple Triple)', 'simple');

            const phase8Query = `${prefixLines}

DELETE WHERE {
    GRAPH vad:rtree {
        vad:executor_mix_b ?p ?o .
    }
}`;

            logBlock('–§–∞–∑–∞ 8 - SPARQL DELETE WHERE (Simple Triple)', phase8Query, 'sparql');
            try {
                await applySparql(phase8Query);
                const remaining = currentStore.getQuads(
                    N3.DataFactory.namedNode('http://example.org/vad#executor_mix_b'),
                    null, null,
                    N3.DataFactory.namedNode('http://example.org/vad#rtree')
                );
                if (remaining.length === 0) {
                    logStep('–§–∞–∑–∞ 8', 'passed', '–ö–æ–Ω—Ü–µ–ø—Ç vad:executor_mix_b —É–¥–∞–ª—ë–Ω (Simple)');
                } else {
                    throw new Error(`–ö–æ–Ω—Ü–µ–ø—Ç –Ω–µ —É–¥–∞–ª—ë–Ω: ${remaining.length} –∫–≤–∞–¥–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å`);
                }
            } catch (error) {
                logStep('–§–∞–∑–∞ 8', 'failed', `–û—à–∏–±–∫–∞: ${error.message}`);
            }

            const rtreeAfterPhase8 = getGraphContent('http://example.org/vad#rtree', currentQuads, currentPrefixes);
            logBlock('–§–∞–∑–∞ 8 - –°–æ–¥–µ—Ä–∂–∏–º–æ–µ vad:rtree –ø–æ—Å–ª–µ DELETE', rtreeAfterPhase8, 'data');

            showSummary();
        }

        // –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            runTest();
        });
    </script>
</body>
</html>
