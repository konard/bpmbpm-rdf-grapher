# Правила валидации идентификаторов (ID) концептов

## Обзор

Данный документ описывает правила валидации идентификаторов (ID), используемых при создании новых концептов через диалог "New Concept" в приложении RDF Grapher.

## Правила валидации ID

### 1. Допустимые символы

ID концепта может содержать:
- Латинские буквы: `a-z`, `A-Z`
- Цифры: `0-9`
- Подчёркивание: `_`
- Точку: `.`
- Дефис: `-`
- **Кириллица (русские буквы)**: `а-я`, `А-Я`, `ё`, `Ё` - **РАЗРЕШЕНА**

### 2. Запрещённые символы

ID концепта **НЕ МОЖЕТ** содержать:
- Пробелы (` `)
- Специальные символы: `!`, `@`, `#`, `$`, `%`, `^`, `&`, `*`, `(`, `)`, `+`, `=`, `{`, `}`, `[`, `]`, `|`, `\`, `/`, `<`, `>`, `,`, `;`, `:`, `'`, `"`, `` ` ``

### 3. Формат ID

- ID не должен начинаться с цифры
- ID не должен быть пустым
- ID не должен содержать префикс (например, `vad:`), так как он добавляется автоматически
- Если пользователь введёт ID с префиксом (например, `vad:MyProcess`), префикс будет автоматически удалён, и использоваться будет только `MyProcess`

### 4. Уникальность

- ID должен быть уникальным в рамках всех загруженных RDF данных
- Перед созданием концепта проверяется, что концепт с таким ID ещё не существует
- При обнаружении дубликата выводится ошибка: "Концепт с ID [id] уже существует. Выберите другой ID."

## Автоматическая генерация ID

При использовании режима автоматической генерации ID:
1. ID формируется из значения поля `rdfs:label` (название концепта)
2. Пробелы заменяются на подчёркивания (`_`)
3. Недопустимые символы удаляются
4. Результат используется как ID

**Пример:**
- `label`: "Мой процесс обработки"
- `ID`: "Мой_процесс_обработки"

## Использование кириллицы

Использование кириллицы в ID **ДОПУСТИМО**, но рекомендуется с осторожностью:

### Преимущества:
- Более понятные и читаемые идентификаторы на русском языке
- Соответствие названиям концептов

### Возможные проблемы:
- Некоторые SPARQL-парсеры могут не поддерживать кириллицу в идентификаторах
- При экспорте в другие системы могут возникнуть проблемы совместимости
- Рекомендуется использовать URL-кодирование при передаче URI с кириллицей

### Рекомендация:
Для максимальной совместимости рекомендуется использовать латиницу в ID, оставляя кириллицу для полей `rdfs:label` и `dcterms:description`.

## Проверки при создании концепта

При нажатии кнопки "Создать запрос New Concept" выполняются следующие проверки:

1. **Проверка выбора типа концепта** - должен быть выбран тип (TypeProcess или TypeExecutor)
2. **Проверка заполнения названия** (`rdfs:label`) - поле не должно быть пустым
3. **Проверка выбора родительского элемента** (`vad:hasParentObj`) - должен быть выбран родительский объект
4. **Проверка наличия ID** - ID должен быть заполнен (вручную или автоматически)
5. **Проверка уникальности ID** - ID не должен совпадать с уже существующими концептами
6. **Санитизация ID** - удаление лишних префиксов (например, `vad:vad:Something` -> `vad:Something`)

## Сообщения об ошибках

| Ошибка | Описание |
|--------|----------|
| "Выберите тип концепта" | Не выбран тип в выпадающем списке |
| "Введите или сгенерируйте ID концепта" | Поле ID пустое |
| "Концепт с ID [id] уже существует" | Концепт с таким ID уже есть в данных |
| "Заполните хотя бы одно обязательное поле (rdfs:label)" | Не заполнено название концепта |

## Техническая реализация

Валидация ID реализована в файле `create_new_concept.js`:

- `generateIdFromLabel(label)` - генерация ID из названия
- `sanitizeConceptId(id)` - санитизация ID (удаление префиксов)
- `checkIdExists(uri)` - проверка существования ID
- `updateCreateButtonState()` - обновление состояния кнопки создания

## История изменений

- **2026-01-28**: Создание документа (Issue #209)
