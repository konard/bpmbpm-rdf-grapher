# Protege Integration Guide for RDF Grapher

## Overview

This guide describes how to use [Protege](https://protege.stanford.edu/) as an ontology editor for the RDF Grapher project (ver8tree). Protege is a free, open-source ontology editor that supports OWL 2 and RDF specifications.

## Table of Contents

1. [Installation](#installation)
2. [File Format Support](#file-format-support)
3. [Opening Project Files in Protege](#opening-project-files-in-protege)
4. [Editing the Ontology](#editing-the-ontology)
5. [Working with Tech Appendix](#working-with-tech-appendix)
6. [Adding New TriG Types](#adding-new-trig-types)
7. [Saving and Exporting](#saving-and-exporting)
8. [Integration with RDF Grapher](#integration-with-rdf-grapher)
9. [Examples](#examples)
10. [Troubleshooting](#troubleshooting)

---

## Installation

### Protege Desktop

1. Download Protege Desktop from: https://protege.stanford.edu/software.php
2. Install the application for your operating system (Windows, macOS, Linux)
3. Launch Protege

### WebProtege (Alternative)

For collaborative editing, use WebProtege at: https://webprotege.stanford.edu/

---

## File Format Support

Protege supports the following formats:

| Format | Extension | Read | Write | Notes |
|--------|-----------|------|-------|-------|
| Turtle | .ttl | Yes | Yes | Human-readable, recommended for editing |
| RDF/XML | .rdf, .owl | Yes | Yes | Standard format |
| OWL/XML | .owx | Yes | Yes | OWL-specific XML |
| JSON-LD | .jsonld | Yes | Yes | JSON-based format |

**Important:** Protege can directly open .ttl files using `File -> Open...` (Ctrl+O).

---

## Opening Project Files in Protege

### Opening vad-basic-ontology.ttl

1. Launch Protege Desktop
2. Select `File -> Open...` (or press `Ctrl+O`)
3. Navigate to `ver8tree/vad-basic-ontology.ttl`
4. Click "Open"

### Opening vad-basic-ontology_tech_Appendix.ttl

1. Select `File -> Open...`
2. Navigate to `ver8tree/vad-basic-ontology_tech_Appendix.ttl`
3. Click "Open"

**Tip:** If double-click doesn't work, always use the File menu to open .ttl files.

---

## Editing the Ontology

### Basic Navigation in Protege

After opening a TTL file, Protege displays several tabs:

- **Active Ontology** - Overview and metadata
- **Entities** - Browse all classes, properties, and individuals
- **Classes** - Hierarchical view of classes
- **Object Properties** - Relations between entities
- **Data Properties** - Attributes with literal values
- **Individuals** - Instances of classes

### Editing Class Definitions

1. Go to the **Classes** tab
2. Find the class in the hierarchy (e.g., `vad:Process`)
3. Click on the class name
4. Edit properties in the right panel:
   - rdfs:label - Display name
   - rdfs:comment - Description
   - rdfs:subClassOf - Parent class

### Editing Property Definitions

1. Go to **Object Properties** or **Data Properties** tab
2. Select the property (e.g., `vad:hasParentObj`)
3. Edit in the right panel:
   - rdfs:domain - What types can have this property
   - rdfs:range - What values are allowed

---

## Working with Tech Appendix

The file `vad-basic-ontology_tech_Appendix.ttl` contains technical classes for configuring the Smart Design window in RDF Grapher.

### Editing vad:ConceptProcessPredicate

This object defines predicates available for TypeProcess in the ptree context.

**In Protege:**

1. Open `vad-basic-ontology_tech_Appendix.ttl`
2. Go to **Individuals** tab
3. Find `vad:ConceptProcessPredicate`
4. Edit the `vad:includePredicate` values

**Example: Adding a new predicate `vad:hasCategory`**

In Protege's individual editor, add to `vad:includePredicate`:
```
vad:hasCategory
```

**Result in TTL:**
```turtle
vad:ConceptProcessPredicate
    rdf:type vad:Tech ;
    rdfs:label "ConceptProcessPredicate" ;
    vad:includePredicate rdf:type, rdfs:label, dcterms:description, vad:hasTrig, vad:hasCategory ;
    # ... rest of definition
```

### Editing vad:IndividProcessPredicate

For individual process properties in VADProcessDia context:

1. Find `vad:IndividProcessPredicate` in Individuals
2. Edit `vad:includePredicate` to add/remove predicates
3. Edit `vad:autoGeneratedPredicate` for auto-filled values

### Creating New Tech Objects

To create a new Tech object (e.g., for a new Subject Type):

1. Go to **Individuals** tab
2. Click the "Add Individual" button
3. Name it following the pattern: `vad:Concept{Type}Predicate`
4. Set `rdf:type` to `vad:Tech`
5. Add `vad:includePredicate` with the list of predicates
6. Add `vad:contextTriGType` to specify the context

---

## Adding New TriG Types

### Example: Adding vad:ObjectTree Variant

To add a new TriG type that extends ObjectTree:

1. Open `vad-basic-ontology.ttl` in Protege
2. Go to **Classes** tab
3. Right-click on `vad:ObjectTree`
4. Select "Add subclass..."
5. Name it (e.g., `vad:CustomTree`)
6. Add properties:
   - rdfs:label
   - rdfs:comment
   - dcterms:description

**TTL Result:**
```turtle
vad:CustomTree
    rdf:type rdfs:Class, owl:Class ;
    rdfs:subClassOf vad:ObjectTree ;
    rdfs:label "CustomTree" ;
    rdfs:comment "Custom tree type for specific use case" ;
    dcterms:description "A custom variant of ObjectTree" .
```

### Adding Tech Predicates for New Type

After creating the type, add a Tech object in `tech_Appendix.ttl`:

```turtle
vad:ConceptCustomTreePredicate
    rdf:type vad:Tech ;
    rdfs:label "ConceptCustomTreePredicate" ;
    vad:includePredicate rdf:type, rdfs:label, vad:hasParentObj ;
    vad:contextTriGType vad:CustomTree ;
    rdfs:comment "Predicates for CustomTree type" ;
    dcterms:description "Group of properties for CustomTree" .
```

---

## Saving and Exporting

### Save in Turtle Format

1. `File -> Save As...`
2. Select format: **Turtle Syntax**
3. Choose location
4. Click "Save"

### Important Notes on Saving

- Protege may reorder triples when saving
- Comments in original TTL may be lost
- Always keep a backup of original files

### Recommended Workflow

1. Make a backup copy of the original file
2. Open and edit in Protege
3. Save with a new name (e.g., `*_edited.ttl`)
4. Review changes using diff tool
5. Apply only necessary changes to original file

---

## Integration with RDF Grapher

### Loading Edited Ontology

After editing files in Protege:

1. Save the file in Turtle format (.ttl)
2. Place the file in the `ver8tree/` folder (replacing the original if needed)
3. Open https://bpmbpm.github.io/rdf-grapher/ver8tree/
4. The application will load the updated ontology

### Effect of Changes

| Change | Effect in RDF Grapher |
|--------|----------------------|
| Edit `vad:ConceptProcessPredicate.includePredicate` | New predicates appear in Predicate dropdown for TypeProcess in ptree |
| Edit `vad:IndividProcessPredicate.includePredicate` | New predicates appear for TypeProcess in VADProcessDia |
| Add new class | New option in Subject Type dropdown (if added to VAD_ALLOWED_TYPES) |
| Edit `vad:hasNodeStyle` | Changes process node appearance on diagram |

### Testing Changes

1. Load the modified ontology in RDF Grapher
2. Select "SPARQL Smart Design" mode
3. Test the Smart Design window:
   - Check Subject Type dropdown
   - Check Predicate dropdown values
   - Verify Object suggestions

---

## Examples

### Example 1: Add a new predicate for processes

**Goal:** Add `vad:priority` predicate to process concepts.

**Steps:**
1. Open `vad-basic-ontology.ttl` in Protege
2. Add new Data Property `vad:priority`:
   - Domain: `vad:TypeProcess`
   - Range: `xsd:integer`
3. Save the file
4. Open `vad-basic-ontology_tech_Appendix.ttl`
5. Find `vad:ConceptProcessPredicate`
6. Add `vad:priority` to `vad:includePredicate`
7. Save the file

**Result:** In Smart Design, when editing TypeProcess in ptree, the "priority" predicate will be available.

### Example 2: Create a new process subtype style

**Goal:** Add a new visual style for "Critical" processes.

**Steps:**
1. Open `vad-basic-ontology_tech_Appendix.ttl`
2. Add new class:
```turtle
vad:Critical
    rdf:type rdfs:Class, owl:Class ;
    rdfs:label "Critical" ;
    vad:hasNodeStyle "shape=\"cds\" height=\"0.8\" width=\"1.5\" color=\"#B71C1C\" fillcolor=\"#FFCDD2\" fontname=\"Arial\" fontsize=\"11\" style=\"filled\"" ;
    vad:styleLegendLabel "Critical Process" ;
    rdfs:comment "Critical process requiring special attention" ;
    dcterms:description "Process marked as critical" .
```
3. Save the file

**Result:** Critical processes will appear with a red color scheme.

### Example 3: Modify auto-generated predicates

**Goal:** Remove automatic executor group creation.

**Steps:**
1. Open `vad-basic-ontology_tech_Appendix.ttl`
2. Find `vad:IndividProcessPredicate`
3. Remove `vad:hasExecutor` from `vad:autoGeneratedPredicate`
4. Save the file

**Result:** When creating new process instances, executor group won't be auto-generated.

---

## Troubleshooting

### File won't open in Protege

- Use `File -> Open...` instead of double-clicking
- Try renaming .ttl to .owl
- Check file encoding (should be UTF-8)

### Lost comments after saving

Protege doesn't preserve all comments when saving. Solution:
1. Keep original file as backup
2. Use diff tool to merge changes manually
3. Or accept the Protege-formatted output

### Missing prefixes

If Protege complains about undefined prefixes:
1. Ensure all prefixes are declared at the top of the file
2. Add any missing prefix declarations

### Classes not appearing

If new classes don't appear in RDF Grapher:
1. Verify the class is a subclass of appropriate type
2. Check if the class needs to be added to `VAD_ALLOWED_TYPES` in JavaScript code
3. Clear browser cache and reload

### Reasoner errors

If Protege's reasoner reports inconsistencies:
1. Check for circular subclass relationships
2. Verify domain/range constraints
3. Try disabling the reasoner: `Reasoner -> None`

---

## File Structure

```
ver8tree/
├── Protege/
│   ├── README.md              # This guide
│   ├── ttl-to-owl.py          # Converter: TTL -> OWL/XML
│   ├── owl-to-ttl.py          # Converter: OWL/XML -> TTL
│   └── examples/
│       ├── add-predicate.md   # Example: adding a predicate
│       └── add-class.md       # Example: adding a class
├── vad-basic-ontology.ttl     # Main ontology (DO NOT edit directly)
├── vad-basic-ontology_tech_Appendix.ttl  # Tech appendix (editable)
└── Trig_VADv5.ttl            # Example RDF data
```

---

## References

- Protege Website: https://protege.stanford.edu/
- Protege Documentation: https://protegewiki.stanford.edu/
- OWL 2 Specification: https://www.w3.org/TR/owl2-overview/
- Turtle Syntax: https://www.w3.org/TR/turtle/
- RDF Grapher Project: https://github.com/bpmbpm/rdf-grapher

---

## Version History

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | 2026-01-27 | Initial version |
