{"version":3,"file":"ActorOptimizeQueryOperationQuerySourceSkolemize.js","sourceRoot":"","sources":["ActorOptimizeQueryOperationQuerySourceSkolemize.ts"],"names":[],"mappings":";;;AAKA,yFAAqF;AACrF,+DAAwF;AAExF,yCAA8C;AAE9C,mEAAgE;AAChE,mCAAsC;AAEtC;;GAEG;AACH,MAAa,+CAAgD,SAAQ,0DAA2B;IAC9F,YAAmB,IAAsC;QACvD,KAAK,CAAC,IAAI,CAAC,CAAC;IACd,CAAC;IAEM,KAAK,CAAC,IAAI,CAAC,OAAsC;QACtD,OAAO,IAAA,mBAAY,GAAE,CAAC;IACxB,CAAC;IAEM,KAAK,CAAC,GAAG,CAAC,MAAqC;QACpD,IAAI,OAAO,GAAG,MAAM,CAAC,OAAO,CAAC;QAE7B,+BAA+B;QAC/B,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,yCAAuB,CAAC,SAAS,CAAC,EAAE,CAAC;YACpD,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC,yCAAuB,CAAC,SAAS,EAAE,IAAI,GAAG,EAAE,CAAC,CAAC;QACtE,CAAC;QACD,MAAM,SAAS,GAAsC,OAAO,CAAC,OAAO,CAAC,yCAAuB,CAAC,SAAS,CAAC,CAAC;QAExG,qCAAqC;QACrC,IAAI,OAAO,CAAC,GAAG,CAAC,oCAAkB,CAAC,YAAY,CAAC,EAAE,CAAC;YACjD,IAAI,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC,oCAAkB,CAAC,YAAY,CAAC,CAAC;YAC/D,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC,EAAE,CAAC,CAAC;gBACtC,MAAM,EAAE,IAAI,6CAAqB,CAAC,aAAa,CAAC,MAAM,EAAE,IAAA,mBAAW,EAAC,SAAS,EAAE,aAAa,CAAC,MAAM,CAAC,CAAC;gBACrG,OAAO,EAAE,aAAa,CAAC,OAAO;aAC/B,CAAC,CAAC,CAAC;YACJ,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC,oCAAkB,CAAC,YAAY,EAAE,OAAO,CAAC,CAAC;QAClE,CAAC;QAED,6CAA6C;QAC7C,IAAI,OAAO,CAAC,GAAG,CAAC,oCAAkB,CAAC,cAAc,CAAC,EAAE,CAAC;YACnD,IAAI,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC,oCAAkB,CAAC,cAAc,CAAC,CAAC;YACjE,OAAO,GAAG,MAAM,CAAC,WAAW,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,CAAC,CAAE,GAAG,EAAE,aAAa,CAAE,EAAE,EAAE,CAAC,CAAC;gBACpF,GAAG;gBACH;oBACE,MAAM,EAAE,IAAI,6CAAqB,CAAC,aAAa,CAAC,MAAM,EAAE,IAAA,mBAAW,EAAC,SAAS,EAAE,aAAa,CAAC,MAAM,CAAC,CAAC;oBACrG,OAAO,EAAE,aAAa,CAAC,OAAO;iBAC/B;aACF,CAAC,CAAC,CAAC,CAAC;YACL,OAAO,GAAG,OAAO,CAAC,GAAG,CAAC,oCAAkB,CAAC,cAAc,EAAE,OAAO,CAAC,CAAC;QACpE,CAAC;QAED,OAAO,EAAE,OAAO,EAAE,SAAS,EAAE,MAAM,CAAC,SAAS,EAAE,CAAC;IAClD,CAAC;CACF;AA3CD,0GA2CC","sourcesContent":["import type {\n  IActionOptimizeQueryOperation,\n  IActorOptimizeQueryOperationOutput,\n  IActorOptimizeQueryOperationArgs,\n} from '@comunica/bus-optimize-query-operation';\nimport { ActorOptimizeQueryOperation } from '@comunica/bus-optimize-query-operation';\nimport { KeysQueryOperation, KeysQuerySourceIdentify } from '@comunica/context-entries';\nimport type { TestResult, IActorTest } from '@comunica/core';\nimport { passTestVoid } from '@comunica/core';\nimport type { QuerySourceReference } from '@comunica/types';\nimport { QuerySourceSkolemized } from './QuerySourceSkolemized';\nimport { getSourceId } from './utils';\n\n/**\n * A comunica Query Source Skolemize Optimize Query Operation Actor.\n */\nexport class ActorOptimizeQueryOperationQuerySourceSkolemize extends ActorOptimizeQueryOperation {\n  public constructor(args: IActorOptimizeQueryOperationArgs) {\n    super(args);\n  }\n\n  public async test(_action: IActionOptimizeQueryOperation): Promise<TestResult<IActorTest>> {\n    return passTestVoid();\n  }\n\n  public async run(action: IActionOptimizeQueryOperation): Promise<IActorOptimizeQueryOperationOutput> {\n    let context = action.context;\n\n    // Determine map of source id's\n    if (!context.has(KeysQuerySourceIdentify.sourceIds)) {\n      context = context.set(KeysQuerySourceIdentify.sourceIds, new Map());\n    }\n    const sourceIds: Map<QuerySourceReference, string> = context.getSafe(KeysQuerySourceIdentify.sourceIds);\n\n    // Wrap sources in skolemized sources\n    if (context.has(KeysQueryOperation.querySources)) {\n      let sources = context.getSafe(KeysQueryOperation.querySources);\n      sources = sources.map(sourceWrapper => ({\n        source: new QuerySourceSkolemized(sourceWrapper.source, getSourceId(sourceIds, sourceWrapper.source)),\n        context: sourceWrapper.context,\n      }));\n      context = context.set(KeysQueryOperation.querySources, sources);\n    }\n\n    // Wrap service sources in skolemized sources\n    if (context.has(KeysQueryOperation.serviceSources)) {\n      let sources = context.getSafe(KeysQueryOperation.serviceSources);\n      sources = Object.fromEntries(Object.entries(sources).map(([ key, sourceWrapper ]) => ([\n        key,\n        {\n          source: new QuerySourceSkolemized(sourceWrapper.source, getSourceId(sourceIds, sourceWrapper.source)),\n          context: sourceWrapper.context,\n        },\n      ])));\n      context = context.set(KeysQueryOperation.serviceSources, sources);\n    }\n\n    return { context, operation: action.operation };\n  }\n}\n"]}