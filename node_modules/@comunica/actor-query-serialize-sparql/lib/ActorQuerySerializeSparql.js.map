{"version":3,"file":"ActorQuerySerializeSparql.js","sourceRoot":"","sources":["ActorQuerySerializeSparql.ts"],"names":[],"mappings":";;;AAKA,uEAAoE;AAEpE,yCAAwD;AACxD,oEAAoD;AAEpD,wCAAmD;AACnD,wEAA0D;AAE1D;;GAEG;AACH,MAAa,yBAA0B,SAAQ,yCAAmB;IAChE,YAAmB,IAA8B;QAC/C,KAAK,CAAC,IAAI,CAAC,CAAC;IACd,CAAC;IAEM,KAAK,CAAC,IAAI,CAAC,MAA6B;QAC7C,IAAI,MAAM,CAAC,WAAW,CAAC,QAAQ,KAAK,QAAQ,EAAE,CAAC;YAC7C,OAAO,IAAA,eAAQ,EAAC,8CAA8C,CAAC,CAAC;QAClE,CAAC;QACD,OAAO,IAAA,mBAAY,GAAE,CAAC;IACxB,CAAC;IAEM,KAAK,CAAC,GAAG,CAAC,MAA6B;QAC5C,MAAM,SAAS,GAAG,IAAI,gCAAS,CAAC;YAC9B,CAAC,yBAAkB,CAAC,EAAE,MAAM,CAAC,QAAQ,KAAK,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACxD,SAAS,EAAE,MAAM,CAAC,WAAW,IAAI,CAAC;SACnC,CAAC,CAAC;QAEH,iFAAiF;QACjF,4EAA4E;QAC5E,gDAAgD;QAChD,MAAM,GAAG,GAAG,IAAA,0BAAK,EAA4B,MAAM,CAAC,SAAS,CAAC,CAAC;QAC/D,MAAM,KAAK,GAAG,SAAS,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC,IAAI,EAAE,CAAC;QAE7C,OAAO,EAAE,KAAK,EAAE,CAAC;IACnB,CAAC;CACF;AA1BD,8DA0BC","sourcesContent":["import type {\n  IActionQuerySerialize,\n  IActorQuerySerializeOutput,\n  IActorQuerySerializeArgs,\n} from '@comunica/bus-query-serialize';\nimport { ActorQuerySerialize } from '@comunica/bus-query-serialize';\nimport type { TestResult, IActorTest } from '@comunica/core';\nimport { passTestVoid, failTest } from '@comunica/core';\nimport { toAst } from '@traqula/algebra-sparql-1-2';\nimport type { Algebra as TraqualAlgebra } from '@traqula/algebra-transformations-1-2';\nimport { traqulaIndentation } from '@traqula/core';\nimport { Generator } from '@traqula/generator-sparql-1-2';\n\n/**\n * A comunica SPARQL Query Serialize Actor.\n */\nexport class ActorQuerySerializeSparql extends ActorQuerySerialize {\n  public constructor(args: IActorQuerySerializeArgs) {\n    super(args);\n  }\n\n  public async test(action: IActionQuerySerialize): Promise<TestResult<IActorTest>> {\n    if (action.queryFormat.language !== 'sparql') {\n      return failTest('This actor can only serialize SPARQL queries');\n    }\n    return passTestVoid();\n  }\n\n  public async run(action: IActionQuerySerialize): Promise<IActorQuerySerializeOutput> {\n    const generator = new Generator({\n      [traqulaIndentation]: action.newlines === false ? -1 : 0,\n      indentInc: action.indentWidth ?? 2,\n    });\n\n    // This query source only handles the Known Algebra from @comunica/utils-algebra.\n    // It will likely throw when unknown algebra operations are being translated\n    // or the translation will not happen correctly.\n    const ast = toAst(<TraqualAlgebra.Operation> action.operation);\n    const query = generator.generate(ast).trim();\n\n    return { query };\n  }\n}\n"]}