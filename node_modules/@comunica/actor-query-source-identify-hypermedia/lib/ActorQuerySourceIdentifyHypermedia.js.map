{"version":3,"file":"ActorQuerySourceIdentifyHypermedia.js","sourceRoot":"","sources":["ActorQuerySourceIdentifyHypermedia.ts"],"names":[],"mappings":";;;AAEA,mFAA+E;AAS/E,+DAA0D;AAC1D,yCAAuE;AAGvE,6EAAmE;AACnE,mEAAgE;AAEhE;;GAEG;AACH,MAAa,kCAAmC,SAAQ,oDAAwB;IAC9D,0BAA0B,CAAgC;IAC1D,kCAAkC,CAAqC;IACvE,iCAAiC,CAAoC;IACrE,sCAAsC,CAAyC;IAC/E,4BAA4B,CAA+B;IAC3D,SAAS,CAAS;IAClB,YAAY,CAAS;IAErC,YAAmB,IAA6C;QAC9D,KAAK,CAAC,IAAI,CAAC,CAAC;QACZ,IAAI,CAAC,0BAA0B,GAAG,IAAI,CAAC,0BAA0B,CAAC;QAClE,IAAI,CAAC,kCAAkC,GAAG,IAAI,CAAC,kCAAkC,CAAC;QAClF,IAAI,CAAC,iCAAiC,GAAG,IAAI,CAAC,iCAAiC,CAAC;QAChF,IAAI,CAAC,sCAAsC,GAAG,IAAI,CAAC,sCAAsC,CAAC;QAC1F,IAAI,CAAC,4BAA4B,GAAG,IAAI,CAAC,4BAA4B,CAAC;QACtE,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC;QAChC,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,YAAY,CAAC;IACxC,CAAC;IAEM,KAAK,CAAC,IAAI,CAAC,MAAkC;QAClD,IAAI,OAAO,MAAM,CAAC,uBAAuB,CAAC,KAAK,KAAK,QAAQ,EAAE,CAAC;YAC7D,OAAO,IAAA,eAAQ,EAAC,GAAG,IAAI,CAAC,IAAI,gFAAgF,CAAC,CAAC;QAChH,CAAC;QACD,OAAO,IAAA,mBAAY,GAAE,CAAC;IACxB,CAAC;IAEM,KAAK,CAAC,GAAG,CAAC,MAAkC;QACjD,MAAM,kBAAkB,GAAG,MAAM,CAAC,uBAAuB,CAAC,OAAO,IAAI,IAAI,oBAAa,EAAE,CAAC;QACzF,MAAM,WAAW,GAAwB,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,+BAAa,CAAC,WAAW,CAAC,CAAC;QAC3F,OAAO;YACL,WAAW,EAAE;gBACX,MAAM,EAAE,IAAI,6CAAqB,CAC/B,IAAI,CAAC,SAAS,EACd,EAAE,GAAG,EAAW,MAAM,CAAC,uBAAuB,CAAC,KAAK,EAAE,eAAe,EAAE,MAAM,CAAC,uBAAuB,CAAC,IAAI,EAAE,EAC5G,IAAI,CAAC,YAAY,EACjB;oBACE,0BAA0B,EAAE,IAAI,CAAC,0BAA0B;oBAC3D,kCAAkC,EAAE,IAAI,CAAC,kCAAkC;oBAC3E,iCAAiC,EAAE,IAAI,CAAC,iCAAiC;oBACzE,sCAAsC,EAAE,IAAI,CAAC,sCAAsC;iBACpF,EACD,WAAW,EACX,MAAM,wCAAe,CAAC,MAAM,CAAC,IAAI,CAAC,4BAA4B,EAAE,MAAM,CAAC,OAAO,EAAE,WAAW,CAAC,CAC7F;gBACD,OAAO,EAAE,kBAAkB;aAC5B;SACF,CAAC;IACJ,CAAC;CACF;AAjDD,gFAiDC","sourcesContent":["import type { MediatorMergeBindingsContext } from '@comunica/bus-merge-bindings-context';\nimport type { MediatorQuerySourceDereferenceLink } from '@comunica/bus-query-source-dereference-link';\nimport { ActorQuerySourceIdentify } from '@comunica/bus-query-source-identify';\nimport type {\n  IActionQuerySourceIdentify,\n  IActorQuerySourceIdentifyOutput,\n  IActorQuerySourceIdentifyArgs,\n} from '@comunica/bus-query-source-identify';\nimport type { MediatorRdfMetadataAccumulate } from '@comunica/bus-rdf-metadata-accumulate';\nimport type { MediatorRdfResolveHypermediaLinks } from '@comunica/bus-rdf-resolve-hypermedia-links';\nimport type { MediatorRdfResolveHypermediaLinksQueue } from '@comunica/bus-rdf-resolve-hypermedia-links-queue';\nimport { KeysInitQuery } from '@comunica/context-entries';\nimport { ActionContext, failTest, passTestVoid } from '@comunica/core';\nimport type { IActorTest, TestResult } from '@comunica/core';\nimport type { ComunicaDataFactory } from '@comunica/types';\nimport { BindingsFactory } from '@comunica/utils-bindings-factory';\nimport { QuerySourceHypermedia } from './QuerySourceHypermedia';\n\n/**\n * A comunica Hypermedia Query Source Identify Actor.\n */\nexport class ActorQuerySourceIdentifyHypermedia extends ActorQuerySourceIdentify {\n  public readonly mediatorMetadataAccumulate: MediatorRdfMetadataAccumulate;\n  public readonly mediatorQuerySourceDereferenceLink: MediatorQuerySourceDereferenceLink;\n  public readonly mediatorRdfResolveHypermediaLinks: MediatorRdfResolveHypermediaLinks;\n  public readonly mediatorRdfResolveHypermediaLinksQueue: MediatorRdfResolveHypermediaLinksQueue;\n  public readonly mediatorMergeBindingsContext: MediatorMergeBindingsContext;\n  public readonly cacheSize: number;\n  public readonly maxIterators: number;\n\n  public constructor(args: IActorQuerySourceIdentifyHypermediaArgs) {\n    super(args);\n    this.mediatorMetadataAccumulate = args.mediatorMetadataAccumulate;\n    this.mediatorQuerySourceDereferenceLink = args.mediatorQuerySourceDereferenceLink;\n    this.mediatorRdfResolveHypermediaLinks = args.mediatorRdfResolveHypermediaLinks;\n    this.mediatorRdfResolveHypermediaLinksQueue = args.mediatorRdfResolveHypermediaLinksQueue;\n    this.mediatorMergeBindingsContext = args.mediatorMergeBindingsContext;\n    this.cacheSize = args.cacheSize;\n    this.maxIterators = args.maxIterators;\n  }\n\n  public async test(action: IActionQuerySourceIdentify): Promise<TestResult<IActorTest>> {\n    if (typeof action.querySourceUnidentified.value !== 'string') {\n      return failTest(`${this.name} requires a single query source with a URL value to be present in the context.`);\n    }\n    return passTestVoid();\n  }\n\n  public async run(action: IActionQuerySourceIdentify): Promise<IActorQuerySourceIdentifyOutput> {\n    const querySourceContext = action.querySourceUnidentified.context ?? new ActionContext();\n    const dataFactory: ComunicaDataFactory = action.context.getSafe(KeysInitQuery.dataFactory);\n    return {\n      querySource: {\n        source: new QuerySourceHypermedia(\n          this.cacheSize,\n          { url: <string> action.querySourceUnidentified.value, forceSourceType: action.querySourceUnidentified.type },\n          this.maxIterators,\n          {\n            mediatorMetadataAccumulate: this.mediatorMetadataAccumulate,\n            mediatorQuerySourceDereferenceLink: this.mediatorQuerySourceDereferenceLink,\n            mediatorRdfResolveHypermediaLinks: this.mediatorRdfResolveHypermediaLinks,\n            mediatorRdfResolveHypermediaLinksQueue: this.mediatorRdfResolveHypermediaLinksQueue,\n          },\n          dataFactory,\n          await BindingsFactory.create(this.mediatorMergeBindingsContext, action.context, dataFactory),\n        ),\n        context: querySourceContext,\n      },\n    };\n  }\n}\n\nexport interface IActorQuerySourceIdentifyHypermediaArgs extends IActorQuerySourceIdentifyArgs {\n  /**\n   * The maximum number of entries in the LRU cache, set to 0 to disable.\n   * @range {integer}\n   * @default {100}\n   */\n  cacheSize: number;\n  /**\n   * The maximum number of links that can be followed in parallel.\n   * @default {64}\n   */\n  maxIterators: number;\n  /**\n   * The metadata accumulate mediator\n   */\n  mediatorMetadataAccumulate: MediatorRdfMetadataAccumulate;\n  /**\n   * The mediator for resolving hypermedia sources\n   */\n  mediatorQuerySourceDereferenceLink: MediatorQuerySourceDereferenceLink;\n  /**\n   * The hypermedia links resolve mediator\n   */\n  mediatorRdfResolveHypermediaLinks: MediatorRdfResolveHypermediaLinks;\n  /**\n   * The hypermedia links queue resolve mediator\n   */\n  mediatorRdfResolveHypermediaLinksQueue: MediatorRdfResolveHypermediaLinksQueue;\n  /**\n   * A mediator for creating binding context merge handlers\n   */\n  mediatorMergeBindingsContext: MediatorMergeBindingsContext;\n}\n"]}