{"version":3,"file":"ActorQueryProcessExplainLogical.js","sourceRoot":"","sources":["ActorQueryProcessExplainLogical.ts"],"names":[],"mappings":";;;AAMA,mEAEqC;AACrC,+DAA0D;AAE1D,yCAA0E;AAE1E;;GAEG;AACH,MAAa,+BAAgC,SAAQ,qCAAiB;IACpD,cAAc,CAA0B;IAExD,YAAmB,IAA0C;QAC3D,KAAK,CAAC,IAAI,CAAC,CAAC;QACZ,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC;IAC5C,CAAC;IAEM,KAAK,CAAC,IAAI,CAAC,MAA2B;QAC3C,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,+BAAa,CAAC,OAAO,CAAC;YAC5C,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,uBAAgB,CAAC,SAAS,CAAC,CAAC,CAAC,KAAK,SAAS,EAAE,CAAC;YACrE,OAAO,IAAA,eAAQ,EAAC,GAAG,IAAI,CAAC,IAAI,sCAAsC,CAAC,CAAC;QACtE,CAAC;QACD,OAAO,IAAA,mBAAY,GAAE,CAAC;IACxB,CAAC;IAEM,KAAK,CAAC,GAAG,CAAC,MAA2B;QAC1C,+BAA+B;QAC/B,IAAI,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,EAAE,MAAM,CAAC,OAAO,CAAC,CAAC;QAC3F,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,MAAM,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC,CAAC;QAElF,OAAO;YACL,MAAM,EAAE;gBACN,OAAO,EAAE,IAAI;gBACb,IAAI,EAAE,SAAS;gBACf,IAAI,EAAE,SAAS;aAChB;SACF,CAAC;IACJ,CAAC;CACF;AA7BD,0EA6BC","sourcesContent":["import type {\n  IActionQueryProcess,\n  IActorQueryProcessOutput,\n  IActorQueryProcessArgs,\n  IQueryProcessSequential,\n} from '@comunica/bus-query-process';\nimport {\n  ActorQueryProcess,\n} from '@comunica/bus-query-process';\nimport { KeysInitQuery } from '@comunica/context-entries';\nimport type { IActorTest, TestResult } from '@comunica/core';\nimport { failTest, passTestVoid, ActionContextKey } from '@comunica/core';\n\n/**\n * A comunica Explain Logical Query Process Actor.\n */\nexport class ActorQueryProcessExplainLogical extends ActorQueryProcess {\n  public readonly queryProcessor: IQueryProcessSequential;\n\n  public constructor(args: IActorQueryProcessExplainLogicalArgs) {\n    super(args);\n    this.queryProcessor = args.queryProcessor;\n  }\n\n  public async test(action: IActionQueryProcess): Promise<TestResult<IActorTest>> {\n    if ((action.context.get(KeysInitQuery.explain) ??\n      action.context.get(new ActionContextKey('explain'))) !== 'logical') {\n      return failTest(`${this.name} can only explain in 'logical' mode.`);\n    }\n    return passTestVoid();\n  }\n\n  public async run(action: IActionQueryProcess): Promise<IActorQueryProcessOutput> {\n    // Parse and optimize the query\n    let { operation, context } = await this.queryProcessor.parse(action.query, action.context);\n    ({ operation, context } = await this.queryProcessor.optimize(operation, context));\n\n    return {\n      result: {\n        explain: true,\n        type: 'logical',\n        data: operation,\n      },\n    };\n  }\n}\n\nexport interface IActorQueryProcessExplainLogicalArgs extends IActorQueryProcessArgs {\n  queryProcessor: IQueryProcessSequential;\n}\n"]}