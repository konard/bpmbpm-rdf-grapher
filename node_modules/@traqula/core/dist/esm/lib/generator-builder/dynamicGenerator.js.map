{"version":3,"file":"dynamicGenerator.js","sourceRoot":"","sources":["../../../../lib/generator-builder/dynamicGenerator.ts"],"names":[],"mappings":"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","sourcesContent":["import { AstCoreFactory } from '../AstCoreFactory.js';\nimport type { SourceLocationInlinedSource } from '../types.js';\nimport { traqulaIndentation, traqulaNewlineAlternative } from '../utils.js';\nimport type { GenRuleMap } from './builderTypes.js';\nimport type { GeneratorRule, RuleDefArg } from './generatorTypes.js';\n\nexport interface GeneratorContext {\n  [traqulaIndentation]?: number;\n  [traqulaNewlineAlternative]?: string;\n}\n\nexport class DynamicGenerator<Context, Names extends string, RuleDefs extends GenRuleMap<Names>> {\n  protected readonly factory = new AstCoreFactory();\n  protected __context: Context | undefined = undefined;\n  protected origSource = '';\n  protected handledInlineSource: SourceLocationInlinedSource | undefined;\n  protected generatedUntil = 0;\n  protected toEnsure: ((willPrint: string) => void)[] = [];\n  /**\n   * Should not contain empty strings\n   * @protected\n   */\n  protected readonly stringBuilder: string[] = [];\n\n  public constructor(protected rules: RuleDefs) {\n    // eslint-disable-next-line ts/no-unnecessary-type-assertion\n    for (const rule of <GeneratorRule[]> Object.values(rules)) {\n      // Define function implementation\n      this[<keyof (typeof this)> rule.name] =\n        <any> ((input: any, context: Context & { origSource: string; offset?: number }, args: any) => {\n          this.stringBuilder.length = 0;\n          this.origSource = context.origSource;\n          this.generatedUntil = context?.offset ?? 0;\n          this.setContext(context);\n\n          this.subrule(rule, input, args);\n\n          this.catchup(this.origSource.length);\n\n          return this.stringBuilder.join('');\n        });\n    }\n  }\n\n  public setContext(context: Context): void {\n    this.__context = context;\n  }\n\n  protected getSafeContext(): Context & GeneratorContext {\n    return <Context & GeneratorContext> this.__context;\n  }\n\n  protected readonly subrule: RuleDefArg['SUBRULE'] = (cstDef, ast, ...arg) => {\n    const def = this.rules[<Names> cstDef.name];\n    if (!def) {\n      throw new Error(`Rule ${cstDef.name} not found`);\n    }\n\n    const generate = (): void => def.gImpl({\n      SUBRULE: this.subrule,\n      PRINT: this.print,\n      ENSURE: this.ensure,\n      ENSURE_EITHER: this.ensureEither,\n      NEW_LINE: this.newLine,\n      HANDLE_LOC: this.handleLoc,\n      CATCHUP: this.catchup,\n\n      PRINT_WORD: this.printWord,\n      PRINT_WORDS: this.printWords,\n      PRINT_ON_EMPTY: this.printOnEmpty,\n      PRINT_ON_OWN_LINE: this.printOnOwnLine,\n    })(ast, this.getSafeContext(), ...arg);\n\n    if (this.factory.isLocalized(ast)) {\n      this.handleLoc(ast, generate);\n    } else {\n      generate();\n    }\n  };\n\n  protected readonly handleLoc: RuleDefArg['HANDLE_LOC'] = (localized, handle) => {\n    if (this.factory.isSourceLocationNoMaterialize(localized.loc)) {\n      return;\n    }\n    if (this.factory.isSourceLocationStringReplace(localized.loc)) {\n      this.catchup(localized.loc.start);\n      this.print(localized.loc.newSource);\n      this.generatedUntil = localized.loc.end;\n      return;\n    }\n    if (this.factory.isSourceLocationNodeReplace(localized.loc)) {\n      this.catchup(localized.loc.start);\n      this.generatedUntil = localized.loc.end;\n    }\n    if (this.factory.isSourceLocationSource(localized.loc)) {\n      this.catchup(localized.loc.start);\n    }\n    if (this.factory.isSourceLocationInlinedSource(localized.loc) && this.handledInlineSource !== localized.loc) {\n      // Calling handleLoc on the same AST multiple times should be the same as doing it once.\n      this.handledInlineSource = localized.loc;\n      this.catchup(localized.loc.start);\n      const origSource = this.origSource;\n      const origPointer = this.generatedUntil;\n      this.origSource = localized.loc.newSource;\n      this.generatedUntil = 0;\n      this.catchup(localized.loc.startOnNew);\n\n      this.handleLoc(localized.loc, handle);\n\n      this.generatedUntil = localized.loc.endOnNew;\n      this.catchup(this.origSource.length);\n      this.origSource = origSource;\n      this.generatedUntil = Math.max(origPointer, localized.loc.end);\n      return;\n    }\n    // If autoGenerate - do nothing\n\n    const ret = handle();\n\n    if (this.factory.isSourceLocationSource(localized.loc)) {\n      this.catchup(localized.loc.end);\n    }\n    return ret;\n  };\n\n  /**\n   * Catchup until, excluding\n   */\n  protected readonly catchup: RuleDefArg['CATCHUP'] = (until) => {\n    const start = this.generatedUntil;\n    if (start < until) {\n      this.print(this.origSource.slice(start, until));\n    }\n    this.generatedUntil = Math.max(this.generatedUntil, until);\n  };\n\n  private handeEnsured(toPrint: string): void {\n    for (const callBack of this.toEnsure) {\n      callBack(toPrint);\n    }\n    this.toEnsure.length = 0;\n  }\n\n  protected readonly print: RuleDefArg['PRINT'] = (...args) => {\n    const joined = args.join('');\n    this.handeEnsured(joined);\n    this.stringBuilder.push(joined);\n  };\n\n  private doesEndWith(subsStr: string): boolean {\n    const len = subsStr.length;\n    let temp = '';\n    while (temp.length < len && this.stringBuilder.length > 0) {\n      temp = this.stringBuilder.pop() + temp;\n    }\n    this.stringBuilder.push(temp);\n    return temp.endsWith(subsStr);\n  }\n\n  protected readonly ensure: RuleDefArg['ENSURE'] = (...args) => {\n    // Check whether already present\n    const toEnsure = args.join('');\n    if (!this.doesEndWith(toEnsure)) {\n      this.toEnsure.push((willPrint) => {\n        if (!willPrint.startsWith(toEnsure) && !this.doesEndWith(toEnsure)) {\n          this.stringBuilder.push(toEnsure);\n        }\n      });\n    }\n  };\n\n  protected readonly ensureEither: RuleDefArg['ENSURE_EITHER'] = (...args) => {\n    if (args.length === 1) {\n      this.ensure(...args);\n    } else if (args.length > 1 &&\n      // Not already matched?\n      !args.some(subStr => this.doesEndWith(subStr))) {\n      this.toEnsure.push((willPrint) => {\n        if (!args.some(subStr => willPrint.startsWith(subStr)) && !args.some(subStr => this.doesEndWith(subStr))) {\n          this.stringBuilder.push(args[0]);\n        }\n      });\n    }\n  };\n\n  private pruneEndingBlanks(): void {\n    let temp = '';\n    while (/^[ \\t]*$/u.test(temp) && this.stringBuilder.length > 0) {\n      temp = this.stringBuilder.pop() + temp;\n    }\n    this.print(temp.trimEnd());\n  }\n\n  protected readonly newLine: RuleDefArg['NEW_LINE'] = (arg) => {\n    const indentation = this.getSafeContext()[traqulaIndentation] ?? 0;\n    const force = arg?.force ?? false;\n    if (indentation < 0) {\n      const newlineAlternative = this.getSafeContext()[traqulaNewlineAlternative];\n      if (newlineAlternative !== undefined &&\n        // If we force, it means we would print \\n no matter. - otherwise check whether we have printed the char\n        (force || (this.stringBuilder.at(-1) !== newlineAlternative))) {\n        this.print(newlineAlternative);\n      }\n      return;\n    }\n    this.pruneEndingBlanks();\n    if (force) {\n      this.print('\\n', ' '.repeat(indentation));\n    } else {\n      let temp = '';\n      while (!temp.includes('\\n') && this.stringBuilder.length > 0) {\n        temp = this.stringBuilder.pop() + temp;\n      }\n      if (/\\n[ \\t]*$/u.test(temp)) {\n        // Pointer is on empty newline -> set correct indentation\n        temp = temp.replace(/\\n[ \\t]*$/u, `\\n${' '.repeat(indentation)}`);\n        this.print(temp);\n      } else {\n        // Pointer not on empty newline, print newline.\n        this.print(temp, '\\n', ' '.repeat(indentation));\n      }\n    }\n  };\n\n  private readonly printWord: RuleDefArg['PRINT_WORD'] = (...args) => {\n    this.ensureEither(' ', '\\n');\n    this.print(...args);\n    this.ensureEither(' ', '\\n');\n  };\n\n  private readonly printWords: RuleDefArg['PRINT_WORD'] = (...args) => {\n    for (const arg of args) {\n      this.printWord(arg);\n    }\n  };\n\n  private readonly printOnEmpty: RuleDefArg['PRINT_ON_EMPTY'] = (...args) => {\n    this.newLine();\n    this.print(...args);\n  };\n\n  private readonly printOnOwnLine: RuleDefArg['PRINT_ON_OWN_LINE'] = (...args) => {\n    this.newLine();\n    this.print(...args);\n    this.newLine();\n  };\n}\n"]}