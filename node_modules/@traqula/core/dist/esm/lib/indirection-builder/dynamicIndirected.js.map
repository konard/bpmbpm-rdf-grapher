{"version":3,"file":"dynamicIndirected.js","sourceRoot":"","sources":["../../../../lib/indirection-builder/dynamicIndirected.ts"],"names":[],"mappings":"AAEA,MAAM,OAAO,eAAe;IAGG;IAFnB,SAAS,GAAwB,SAAS,CAAC;IAErD,YAA6B,KAAe;QAAf,UAAK,GAAL,KAAK,CAAU;QAC1C,KAAK,MAAM,IAAI,IAAI,MAAM,CAAC,MAAM,CAAoC,KAAK,CAAC,EAAE,CAAC;YAC3E,IAAI,CAAsB,IAAI,CAAC,IAAI,CAAC,GAAS,CAAC,CAAC,OAAgB,EAAE,GAAG,IAAS,EAAO,EAAE;gBACpF,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC;gBACzB,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,GAAG,IAAI,CAAC,CAAC;YACrC,CAAC,CAAC,CAAC;QACL,CAAC;IACH,CAAC;IAEM,UAAU,CAAC,OAAgB;QAChC,IAAI,CAAC,SAAS,GAAG,OAAO,CAAC;IAC3B,CAAC;IAES,cAAc;QACtB,OAAiB,IAAI,CAAC,SAAS,CAAC;IAClC,CAAC;IAEkB,OAAO,GAA2B,CAAC,MAAM,EAAE,GAAG,IAAI,EAAE,EAAE;QACvE,MAAM,GAAG,GAAG,IAAI,CAAC,KAAK,CAAmB,MAAM,CAAC,IAAI,CAAC,CAAC;QACtD,IAAI,CAAC,GAAG,EAAE,CAAC;YACT,MAAM,IAAI,KAAK,CAAC,QAAQ,MAAM,CAAC,IAAI,YAAY,CAAC,CAAC;QACnD,CAAC;QAED,OAAa,GAAG,CAAC,GAAG,CAAC;YACnB,OAAO,EAAE,IAAI,CAAC,OAAO;SACtB,CAAC,CAAC,IAAI,CAAC,cAAc,EAAE,EAAE,GAAG,IAAI,CAAC,CAAC;IACrC,CAAC,CAAC;CACH","sourcesContent":["import type { IndirDef, IndirDefArg, IndirectionMap } from './helpers.js';\n\nexport class DynamicIndirect<Context, Names extends string, RuleDefs extends IndirectionMap<Names>> {\n  protected __context: Context | undefined = undefined;\n\n  public constructor(protected rules: RuleDefs) {\n    for (const rule of Object.values(<Record<string, IndirDef<Context>>>rules)) {\n      this[<keyof (typeof this)>rule.name] = <any> ((context: Context, ...args: any): any => {\n        this.setContext(context);\n        return this.subrule(rule, ...args);\n      });\n    }\n  }\n\n  public setContext(context: Context): void {\n    this.__context = context;\n  }\n\n  protected getSafeContext(): Context {\n    return <Context> this.__context;\n  }\n\n  protected readonly subrule: IndirDefArg['SUBRULE'] = (cstDef, ...args) => {\n    const def = this.rules[<Names> <unknown> cstDef.name];\n    if (!def) {\n      throw new Error(`Rule ${cstDef.name} not found`);\n    }\n\n    return <any> def.fun({\n      SUBRULE: this.subrule,\n    })(this.getSafeContext(), ...args);\n  };\n}\n"]}