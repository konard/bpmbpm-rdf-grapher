"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.algToSparql = void 0;
const core_js_1 = require("../toAlgebra/core.js");
const core_js_2 = require("./core.js");
const pattern_js_1 = require("./pattern.js");
const quads_js_1 = require("./quads.js");
const updateUnit_js_1 = require("./updateUnit.js");
exports.algToSparql = {
    name: 'algToSparql',
    fun: ({ SUBRULE }) => (_, op) => {
        SUBRULE(core_js_2.resetContext);
        op = SUBRULE(quads_js_1.removeAlgQuads, op);
        if (op.type === core_js_1.types.COMPOSITE_UPDATE) {
            return SUBRULE(updateUnit_js_1.translateAlgCompositeUpdate, op);
        }
        if (op.type === core_js_1.types.NOP) {
            return SUBRULE(updateUnit_js_1.toUpdate, []);
        }
        try {
            return SUBRULE(updateUnit_js_1.toUpdate, [SUBRULE(updateUnit_js_1.translateAlgUpdateOperation, op)]);
        }
        catch { /* That's okay, it's not an update */ }
        // If no Update, must be query.
        const result = SUBRULE(pattern_js_1.translateAlgPatternIntoGroup, op);
        return result.patterns[0];
    },
};
//# sourceMappingURL=toAst.js.map