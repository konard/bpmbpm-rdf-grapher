{"version":3,"file":"toAst.js","sourceRoot":"","sources":["../../../../lib/toAst/toAst.ts"],"names":[],"mappings":";;;AAEA,kDAA6C;AAE7C,uCAAyC;AAEzC,6CAEsB;AACtB,yCAA4C;AAE5C,mDAIyB;AAEZ,QAAA,WAAW,GAA8D;IACpF,IAAI,EAAE,aAAa;IACnB,GAAG,EAAE,CAAC,EAAE,OAAO,EAAE,EAAE,EAAE,CAAC,CAAC,CAAC,EAAE,EAAE,EAAE,EAAE;QAC9B,OAAO,CAAC,sBAAY,CAAC,CAAC;QACtB,EAAE,GAAG,OAAO,CAAC,yBAAc,EAAE,EAAE,CAAC,CAAC;QACjC,IAAI,EAAE,CAAC,IAAI,KAAK,eAAK,CAAC,gBAAgB,EAAE,CAAC;YACvC,OAAO,OAAO,CAAC,2CAA2B,EAAE,EAAE,CAAC,CAAC;QAClD,CAAC;QACD,IAAI,EAAE,CAAC,IAAI,KAAK,eAAK,CAAC,GAAG,EAAE,CAAC;YAC1B,OAAO,OAAO,CAAC,wBAAQ,EAAE,EAAE,CAAC,CAAC;QAC/B,CAAC;QACD,IAAI,CAAC;YACH,OAAO,OAAO,CAAC,wBAAQ,EAAE,CAAE,OAAO,CAAC,2CAA2B,EAAmB,EAAE,CAAC,CAAE,CAAC,CAAC;QAC1F,CAAC;QAAC,MAAM,CAAC,CAAC,qCAAqC,CAAA,CAAC;QAChD,+BAA+B;QAC/B,MAAM,MAAM,GAAG,OAAO,CAAC,yCAA4B,EAAE,EAAE,CAAC,CAAC;QACzD,OAAe,MAAM,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;IACpC,CAAC;CACF,CAAC","sourcesContent":["import type { Query, SparqlQuery } from '@traqula/rules-sparql-1-1';\nimport type * as Algebra from '../algebra.js';\nimport { types } from '../toAlgebra/core.js';\nimport type { AstIndir } from './core.js';\nimport { resetContext } from './core.js';\n\nimport {\n  translateAlgPatternIntoGroup,\n} from './pattern.js';\nimport { removeAlgQuads } from './quads.js';\n\nimport {\n  toUpdate,\n  translateAlgCompositeUpdate,\n  translateAlgUpdateOperation,\n} from './updateUnit.js';\n\nexport const algToSparql: AstIndir<'algToSparql', SparqlQuery, [Algebra.Operation]> = {\n  name: 'algToSparql',\n  fun: ({ SUBRULE }) => (_, op) => {\n    SUBRULE(resetContext);\n    op = SUBRULE(removeAlgQuads, op);\n    if (op.type === types.COMPOSITE_UPDATE) {\n      return SUBRULE(translateAlgCompositeUpdate, op);\n    }\n    if (op.type === types.NOP) {\n      return SUBRULE(toUpdate, []);\n    }\n    try {\n      return SUBRULE(toUpdate, [ SUBRULE(translateAlgUpdateOperation, <Algebra.Update> op) ]);\n    } catch { /* That's okay, it's not an update */}\n    // If no Update, must be query.\n    const result = SUBRULE(translateAlgPatternIntoGroup, op);\n    return <Query> result.patterns[0];\n  },\n};\n"]}