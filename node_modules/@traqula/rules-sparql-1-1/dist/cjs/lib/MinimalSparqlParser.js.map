{"version":3,"file":"MinimalSparqlParser.js","sourceRoot":"","sources":["../../../lib/MinimalSparqlParser.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Localized } from '@traqula/core';\nimport { traqulaNewlineAlternative, TransformerObject, traqulaIndentation } from '@traqula/core';\nimport { AstFactory } from './astFactory.js';\nimport type { SparqlContext, SparqlGeneratorContext } from './sparql11HelperTypes.js';\nimport type { Path, TermIri } from './Sparql11types.js';\n\ninterface Parser<ParseRet> {\n  queryOrUpdate: (input: string, context: SparqlContext) => ParseRet;\n  path: (input: string, context: SparqlContext) => TermIri | Path;\n}\n\nexport function completeParseContext(\n  context: Partial<SparqlContext>,\n): SparqlContext {\n  return {\n    astFactory: context.astFactory ?? new AstFactory({ tracksSourceLocation: false }),\n    baseIRI: context.baseIRI,\n    prefixes: { ...context.prefixes },\n    parseMode: context.parseMode ? new Set(context.parseMode) : new Set([ 'canParseVars', 'canCreateBlankNodes' ]),\n    skipValidation: context.skipValidation ?? false,\n  };\n}\n\nexport function completeGeneratorContext(\n  context: Partial<SparqlGeneratorContext & { offset?: number }>,\n): SparqlGeneratorContext & { offset?: number } {\n  return {\n    astFactory: context.astFactory ?? new AstFactory(),\n    origSource: context.origSource ?? '',\n    offset: context.offset,\n    [traqulaIndentation]: context[traqulaIndentation] ?? 0,\n    [traqulaNewlineAlternative]: context[traqulaNewlineAlternative] ?? ' ',\n    indentInc: context.indentInc ?? 2,\n  };\n}\n\nexport function copyParseContext<T extends\nPartial<SparqlContext & SparqlGeneratorContext & { origSource: string; offset?: number }>>(\n  context: T,\n): T {\n  return {\n    ...context,\n    prefixes: { ...context.prefixes },\n    parseMode: new Set(context.parseMode),\n  };\n}\n\nexport class MinimalSparqlParser<ParseRet extends Localized> {\n  protected readonly defaultContext: SparqlContext;\n  protected readonly coreTransformer = new TransformerObject();\n\n  public constructor(protected readonly parser: Parser<ParseRet>, defaultContext: Partial<SparqlContext> = {}) {\n    this.defaultContext = completeParseContext(defaultContext);\n  }\n\n  /**\n   * Parse a query string starting from the\n   * [QueryUnit](https://www.w3.org/TR/sparql11-query/#rQueryUnit)\n   * or [QueryUpdate](https://www.w3.org/TR/sparql11-query/#rUpdateUnit) rules.\n   * @param query\n   * @param context\n   */\n  public parse(query: string, context: Partial<SparqlContext> = {}): ParseRet {\n    const ast = this.parser.queryOrUpdate(query, copyParseContext({ ...this.defaultContext, ...context }));\n    ast.loc = this.defaultContext.astFactory.sourceLocationInlinedSource(query, ast.loc, 0, Number.MAX_SAFE_INTEGER);\n    return ast;\n  }\n\n  /**\n   * Parse a query string starting from the [Path](https://www.w3.org/TR/sparql11-query/#rPath) grammar rule.\n   * @param query\n   * @param context\n   */\n  public parsePath(query: string, context: Partial<SparqlContext> = {}):\n    (Path & { prefixes: object }) | TermIri {\n    const ast = this.parser.path(query, copyParseContext({ ...this.defaultContext, ...context }));\n    ast.loc = this.defaultContext.astFactory.sourceLocationInlinedSource(query, ast.loc, 0, Number.MAX_SAFE_INTEGER);\n    if (this.defaultContext.astFactory.isPathPure(ast)) {\n      return {\n        ...ast,\n        prefixes: {},\n      };\n    }\n    return ast;\n  }\n}\n"]}