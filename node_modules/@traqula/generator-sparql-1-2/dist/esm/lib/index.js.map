{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../lib/index.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,gBAAgB,EAAE,MAAM,eAAe,CAAC;AAEjD,OAAO,EAAE,wBAAwB,EAAE,MAAM,+BAA+B,CAAC;AAEzE,OAAO,EAAE,IAAI,IAAI,GAAG,EAAE,wBAAwB,EAAE,MAAM,2BAA2B,CAAC;AAGlF,MAAM,CAAC,MAAM,wBAAwB,GACnC,gBAAgB,CAAC,MAAM,CAAC,wBAAwB,CAAC;KAC9C,YAAY,EAA8B;KAC1C,SAAS,EA6EN;KACH,OAAO,CAAC,GAAG,CAAC,UAAU,CAAC;KACvB,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC;KAC1B,SAAS,CAAC,GAAG,CAAC,aAAa,CAAC;KAC5B,OAAO,CAAC,GAAG,CAAC,mBAAmB,CAAC;KAChC,OAAO,CAAC,GAAG,CAAC,cAAc,CAAC;KAC3B,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC;KACxB,SAAS,CAAC,GAAG,CAAC,QAAQ,CAAC;KACvB,SAAS,CAAC,GAAG,CAAC,oBAAoB,CAAC;KACnC,SAAS,CAAC,GAAG,CAAC,iBAAiB,CAAC,CAAC;AAItC;;GAEG;AACH,MAAM,OAAO,SAAS;IACD,cAAc,CAA6B;IAC9D,YAAmB,iBAAsD,EAAE;QACzE,IAAI,CAAC,cAAc,GAAG,wBAAwB,CAAC,cAAc,CAAC,CAAC;IACjE,CAAC;IAEgB,SAAS,GAAoB,wBAAwB,CAAC,KAAK,EAAE,CAAC;IAE/E;;;;;;OAMG;IACI,QAAQ,CAAC,GAA2B,EAAE,UAA+C,EAAE;QAC5F,OAAO,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,GAAG,EAAE,EAAE,GAAG,IAAI,CAAC,cAAc,EAAE,GAAG,OAAO,EAAE,CAAC,CAAC,IAAI,EAAE,CAAC;IAC1F,CAAC;IAED;;;;OAIG;IACI,YAAY,CAAC,GAAa,EAAE,UAA+C,EAAE;QAClF,OAAO,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,EAAE,EAAE,GAAG,IAAI,CAAC,cAAc,EAAE,GAAG,OAAO,EAAE,EAAE,SAAS,CAAC,CAAC,IAAI,EAAE,CAAC;IAC5F,CAAC;CACF","sourcesContent":["import { GeneratorBuilder } from '@traqula/core';\nimport type { Wrap, Patch } from '@traqula/core';\nimport { sparql11GeneratorBuilder } from '@traqula/generator-sparql-1-1';\nimport type { gram as g11 } from '@traqula/rules-sparql-1-1';\nimport { gram as g12, completeGeneratorContext } from '@traqula/rules-sparql-1-2';\nimport type * as T12 from '@traqula/rules-sparql-1-2';\n\nexport const sparql12GeneratorBuilder =\n  GeneratorBuilder.create(sparql11GeneratorBuilder)\n    .widenContext<T12.SparqlGeneratorContext>()\n    .typePatch<{\n      [g11.queryOrUpdate.name]: [T12.SparqlQuery];\n      [g11.query.name]: [T12.Query];\n      [g11.selectQuery.name]: [Omit<T12.QuerySelect, g11.HandledByBase>];\n      [g11.constructQuery.name]: [ Omit<T12.QueryConstruct, g11.HandledByBase>];\n      [g11.describeQuery.name]: [Omit<T12.QueryDescribe, g11.HandledByBase>];\n      [g11.askQuery.name]: [Omit<T12.QueryAsk, g11.HandledByBase>];\n      [g11.selectClause.name]: [ Wrap<Pick<T12.QuerySelect, 'variables' | 'distinct' | 'reduced'>> ];\n\n      [g11.update.name]: [T12.Update];\n      [g11.update1.name]: [T12.UpdateOperation];\n      [g11.load.name]: [T12.UpdateOperationLoad];\n      [g11.clear.name]: [T12.UpdateOperationClear];\n      [g11.drop.name]: [T12.UpdateOperationDrop];\n      [g11.create.name]: [T12.UpdateOperationCreate];\n      [g11.copy.name]: [T12.UpdateOperationCopy];\n      [g11.move.name]: [T12.UpdateOperationMove];\n      [g11.add.name]: [T12.UpdateOperationAdd];\n      [g11.insertData.name]: [T12.UpdateOperationInsertData];\n      [g11.deleteData.name]: [T12.UpdateOperationDeleteData];\n      [g11.deleteWhere.name]: [T12.UpdateOperationDeleteWhere];\n      [g11.modify.name]: [T12.UpdateOperationModify];\n      [g11.graphRef.name]: [T12.TermIri];\n      [g11.graphRefAll.name]: [T12.GraphRef];\n      [g11.quads.name]: [Wrap<T12.Quads[]>];\n      [g11.quadsNotTriples.name]: [T12.GraphQuads];\n\n      [g11.aggregate.name]: [ T12.ExpressionAggregate ];\n\n      [g11.datasetClauseStar.name]: [ T12.DatasetClauses ];\n      [g11.usingClauseStar.name]: [ T12.DatasetClauses ];\n\n      // [g11.datasetClause.name]: unchanged;\n      [g11.argList.name]: [ Patch<g11.IArgList, { args: T12.Expression[] }> ];\n      [g11.expression.name]: [ T12.Expression ];\n      [g11.iriOrFunction.name]: [T12.TermIri | T12.ExpressionFunctionCall];\n\n      [g11.prologue.name]: [ T12.ContextDefinition[] ];\n      [g11.prefixDecl.name]: [ T12.ContextDefinitionPrefix ];\n      [g11.baseDecl.name]: [ T12.ContextDefinitionBase ];\n      // [g11.var_.name]: unchanged;\n      [g11.varOrTerm.name]: [ T12.Term ];\n      [g11.graphTerm.name]: [ T12.GraphTerm ];\n\n      [g11.rdfLiteral.name]: [T12.TermLiteral];\n      // [g11.string.name]: unchanged;\n      // [g11.iri.name]: unchanged;\n      // [g11.iriFull.name]: unchanged;\n      // [g11.prefixedName.name]: unchanged;\n      // [g11.blankNode.name]: unchanged;\n\n      // [g11.path.name]: unchanged;\n      //\n      [g11.solutionModifier.name]: [ T12.SolutionModifiers ];\n      [g11.groupClause.name]: [ T12.SolutionModifierGroup ];\n      [g11.havingClause.name]: [ T12.SolutionModifierHaving ];\n      [g11.orderClause.name]: [ T12.SolutionModifierOrder ];\n      [g11.limitOffsetClauses.name]: [ T12.SolutionModifierLimitOffset ];\n\n      [g11.triplesBlock.name]: [ T12.PatternBgp ];\n      [g11.collectionPath.name]: [ T12.TripleCollectionList ];\n      [g11.blankNodePropertyListPath.name]: [ T12.TripleCollectionBlankNodeProperties ];\n      [g11.triplesNodePath.name]: [ T12.TripleCollection ];\n      [g11.graphNodePath.name]: [ T12.Term | T12.TripleCollection ];\n\n      [g11.whereClause.name]: [ Wrap<T12.PatternGroup> ];\n      [g11.generatePattern.name]: [ T12.Pattern ];\n      [g11.groupGraphPattern.name]: [ T12.PatternGroup ];\n      [g11.graphPatternNotTriples.name]: [ Exclude<T12.Pattern, T12.SubSelect | T12.PatternBgp> ];\n      [g11.optionalGraphPattern.name]: [ T12.PatternOptional ];\n      [g11.graphGraphPattern.name]: [ T12.PatternGroup ];\n      [g11.serviceGraphPattern.name]: [ T12.PatternService ];\n      [g11.bind.name]: [ T12.PatternBind ];\n      [g11.inlineData.name]: [ T12.PatternValues ];\n      [g11.minusGraphPattern.name]: [ T12.PatternMinus ];\n      [g11.groupOrUnionGraphPattern.name]: [ T12.PatternGroup | T12.PatternUnion ];\n      [g11.filter.name]: [ T12.PatternFilter ];\n    }>()\n    .addRule(g12.tripleTerm)\n    .addRule(g12.reifiedTriple)\n    .patchRule(g12.graphNodePath)\n    .addRule(g12.annotationBlockPath)\n    .addRule(g12.annotationPath)\n    .addRule(g12.versionDecl)\n    .patchRule(g12.prologue)\n    .patchRule(g12.generateTriplesBlock)\n    .patchRule(g12.generateGraphTerm);\n\nexport type SparqlGenerator = ReturnType<typeof sparql12GeneratorBuilder.build>;\n\n/**\n * Generator that can generate a SPARQL 1.2 query string given a SPARQL 1.2 Traqula AST.\n */\nexport class Generator {\n  protected readonly defaultContext: T12.SparqlGeneratorContext;\n  public constructor(defaultContext: Partial<T12.SparqlGeneratorContext> = {}) {\n    this.defaultContext = completeGeneratorContext(defaultContext);\n  }\n\n  private readonly generator: SparqlGenerator = sparql12GeneratorBuilder.build();\n\n  /**\n   * Generates a query string starting from the\n   * [QueryUnit](https://www.w3.org/TR/sparql12-query/#rQueryUnit)\n   * or [QueryUpdate](https://www.w3.org/TR/sparql12-query/#rUpdateUnit) rules.\n   * @param ast\n   * @param context\n   */\n  public generate(ast: T12.Query | T12.Update, context: Partial<T12.SparqlGeneratorContext> = {}): string {\n    return this.generator.queryOrUpdate(ast, { ...this.defaultContext, ...context }).trim();\n  }\n\n  /**\n   * Generates a query string starting from the [Path](https://www.w3.org/TR/sparql12-query/#rPath) grammar rule.\n   * @param ast\n   * @param context\n   */\n  public generatePath(ast: T12.Path, context: Partial<T12.SparqlGeneratorContext> = {}): string {\n    return this.generator.path(ast, { ...this.defaultContext, ...context }, undefined).trim();\n  }\n}\n"]}