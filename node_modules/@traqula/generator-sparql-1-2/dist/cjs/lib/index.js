"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.Generator = exports.sparql12GeneratorBuilder = void 0;
const core_1 = require("@traqula/core");
const generator_sparql_1_1_1 = require("@traqula/generator-sparql-1-1");
const rules_sparql_1_2_1 = require("@traqula/rules-sparql-1-2");
exports.sparql12GeneratorBuilder = core_1.GeneratorBuilder.create(generator_sparql_1_1_1.sparql11GeneratorBuilder)
    .widenContext()
    .typePatch()
    .addRule(rules_sparql_1_2_1.gram.tripleTerm)
    .addRule(rules_sparql_1_2_1.gram.reifiedTriple)
    .patchRule(rules_sparql_1_2_1.gram.graphNodePath)
    .addRule(rules_sparql_1_2_1.gram.annotationBlockPath)
    .addRule(rules_sparql_1_2_1.gram.annotationPath)
    .addRule(rules_sparql_1_2_1.gram.versionDecl)
    .patchRule(rules_sparql_1_2_1.gram.prologue)
    .patchRule(rules_sparql_1_2_1.gram.generateTriplesBlock)
    .patchRule(rules_sparql_1_2_1.gram.generateGraphTerm);
/**
 * Generator that can generate a SPARQL 1.2 query string given a SPARQL 1.2 Traqula AST.
 */
class Generator {
    defaultContext;
    constructor(defaultContext = {}) {
        this.defaultContext = (0, rules_sparql_1_2_1.completeGeneratorContext)(defaultContext);
    }
    generator = exports.sparql12GeneratorBuilder.build();
    /**
     * Generates a query string starting from the
     * [QueryUnit](https://www.w3.org/TR/sparql12-query/#rQueryUnit)
     * or [QueryUpdate](https://www.w3.org/TR/sparql12-query/#rUpdateUnit) rules.
     * @param ast
     * @param context
     */
    generate(ast, context = {}) {
        return this.generator.queryOrUpdate(ast, { ...this.defaultContext, ...context }).trim();
    }
    /**
     * Generates a query string starting from the [Path](https://www.w3.org/TR/sparql12-query/#rPath) grammar rule.
     * @param ast
     * @param context
     */
    generatePath(ast, context = {}) {
        return this.generator.path(ast, { ...this.defaultContext, ...context }, undefined).trim();
    }
}
exports.Generator = Generator;
//# sourceMappingURL=index.js.map